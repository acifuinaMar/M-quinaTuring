<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>M√°quina de Turing</title>
    <style>
        * {
            /*Para toda la pagina */
            box-sizing: border-box;
            font-family: 'Century Gothic';
        }
        /*Para el cuerpo/body de la pagina*/
        body{
            margin: 0;
            padding: 20px;
            background-color: #f7f5fa;
            color: #555;
        }
        /*Contenedor principal*/
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 50px rgba(0,0,0,0.2);
        }
        /*Titulo*/
        h1 {
            text-align: center;
            color: #3a2d47;
            margin-bottom: 30px;
        }
        /*Cajita*/
        .panel {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        /*Titulo dentro de las cajitas*/
        .panel-title{
            font-weight: bold;
            margin-bottom: 10px;
            color: #3a2d47;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        /*Formulario*/
        .form-group{
            margin-bottom: 15px;
        }
        /*Label sobre los campos*/
        label{
            display: block; 
            margin-bottom: 5px; 
            font-weight: 500;
        }
        input[type="text"], select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        /*Botones*/
        button {
            background-color: #8c34e3;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        /*Cambiar color cuando pase el mouse*/
        button:hover {
            background-color: #792dc4;
        }
        /*Color para cuando el boton no est√© disponible*/
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        /*Tabla*/
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        /*Encabezado de tablas*/
        th {
            background-color: #f2f2f2;
        }
        /*Caja para la cinta*/
        .tape-container {
            display: flex;
            overflow-x: auto;
            margin: 20px 0;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
        }
        /*Celdas de la cinta*/
        .tape-cell {
            min-width: 50px;
            height: 50px;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            background-color: white;
            margin-right: 2px;
        }
        /*Celdas activa*/
        .tape-cell.active {
            background-color: #792dc4;
            color: white;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        /*Palabra aceptada*/
        .status.accepted {
            background-color: #d4edda;
            color: #155724;
        }
        /*Palabra rechazada*/
        .status.rejected {
            background-color: #f8d7da;
            color: #721c24;
        }
        /*Palabra en ejecucion*/
        .status.running {
            background-color: #cce5ff;
            color: #004085;
        }
        /*Caja para mostrar que ha hecho la maquina de turing*/
        .history-container {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .history-item {
            margin-bottom: 5px;
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        /*Caja para pesta√±as*/
        .tab-container {
            margin-bottom: 20px;
        }
        /*Botones para moverse de pesta√±a*/
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        .tab-button {
            padding: 10px 20px;
            background-color: #f2f2f2;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            cursor: pointer;
        }
        .tab-button.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Simulador de M√°quina de Turing</h1>
        
        <div class="tab-container">
            <div class="tab-buttons">
                <div class="tab-button active" onclick="cambiarPesta√±a(0)">Configuraci√≥n</div>
                <div class="tab-button" onclick="cambiarPesta√±a(1)">Transiciones</div>
                <div class="tab-button" onclick="cambiarPesta√±a(2)">Simulaci√≥n</div>
            </div>
            
            <div class="tab-content active" id="tab0">
                <div class="panel">
                    <div class="panel-title">Estados</div>
                    <div class="form-group">
                        <label for="estados">Estados (separados por coma):</label>
                        <input type="text" id="estados" placeholder="q0, q1, q2, q3">
                    </div>
                    <div class="form-group">
                        <label for="estadoInicial">Estado inicial:</label>
                        <input type="text" id="estadoInicial" placeholder="q0">
                    </div>
                    <div class="form-group">
                        <label for="estadosAceptacion">Estados de aceptaci√≥n (separados por coma):</label>
                        <input type="text" id="estadosAceptacion" placeholder="q3">
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Alfabetos</div>
                    <div class="form-group">
                        <label for="alfabetoEntrada">Alfabeto de entrada (separados por coma):</label>
                        <input type="text" id="alfabetoEntrada" placeholder="0, 1">
                    </div>
                    <div class="form-group">
                        <label for="alfabetoCinta">Alfabeto de cinta (separados por coma):</label>
                        <input type="text" id="alfabetoCinta" placeholder="0, 1, X, Y, B">
                    </div>
                    <div class="form-group">
                        <label for="simboloBlanco">S√≠mbolo blanco:</label>
                        <input type="text" id="simboloBlanco" value="B" maxlength="1">
                    </div>
                </div>
                
                <button onclick="guardarConfiguracion()">Guardar Configuraci√≥n</button>
                <button onclick="limpiarConfiguracion()">üßπ Limpiar Configuraci√≥n</button>
            </div>
            
            <div class="tab-content" id="tab1">
                <div class="panel">
                    <div class="panel-title">Definir Transiciones</div>
                    <div class="form-group">
                        <label for="transEstado">Estado actual:</label>
                        <input type="text" id="transEstado" placeholder="q0">
                    </div>
                    <div class="form-group">
                        <label for="transLeer">S√≠mbolo a leer:</label>
                        <input type="text" id="transLeer" placeholder="0" maxlength="1">
                    </div>
                    <div class="form-group">
                        <label for="transNuevoEstado">Nuevo estado:</label>
                        <input type="text" id="transNuevoEstado" placeholder="q1">
                    </div>
                    <div class="form-group">
                        <label for="transEscribir">S√≠mbolo a escribir:</label>
                        <input type="text" id="transEscribir" placeholder="X" maxlength="1">
                    </div>
                    <div class="form-group">
                        <label for="transDireccion">Direcci√≥n:</label>
                        <select id="transDireccion">
                            <option value="L">Izquierda (L)</option>
                            <option value="R">Derecha (R)</option>
                            <option value="S">Permanecer (S)</option>
                        </select>
                    </div>
                    <button onclick="agregarTransicion()">Agregar Transici√≥n</button>
                    <button onclick="limpiarTransiciones()">üßπ Limpiar Transiciones</button>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Transiciones Definidas</div>
                    <table id="tablaTransiciones">
                        <thead>
                            <tr>
                                <th>Estado</th>
                                <th>Leer</th>
                                <th>Nuevo Estado</th>
                                <th>Escribir</th>
                                <th>Direcci√≥n</th>
                                <th>Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Las transiciones se agregar√°n aqu√≠ din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="tab-content" id="tab2">
                <div class="panel">
                    <div class="panel-title">Simulaci√≥n</div>
                    <div class="form-group">
                        <label for="cadenaEntrada">Cadena de entrada:</label>
                        <input type="text" id="cadenaEntrada" placeholder="Ej: 1010">
                    </div>
                    <button onclick="iniciarSimulacion()">Iniciar Simulaci√≥n</button>
                    <button onclick="ejecutarPaso()" id="btnPaso" disabled>Ejecutar Paso</button>
                    <button onclick="detenerSimulacion()" id="btnDetener" disabled>Detener</button>
                    <button onclick="reiniciarSimulacion()">Reiniciar</button>
                    <button onclick="limpiarSimulacion()">üßπ Limpiar Simulaci√≥n</button>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Estado Actual</div>
                    <div id="estadoActual">No iniciado</div>
                    <div class="status" id="estadoAceptacion"></div>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Cinta</div>
                    <div class="tape-container" id="cinta">
                        <!-- La cinta se generar√° aqu√≠ din√°micamente -->
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Historial de Ejecuci√≥n</div>
                    <div class="history-container" id="historial">
                        <!-- El historial se agregar√° aqu√≠ din√°micamente -->
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Guardar/Cargar Configuraci√≥n</div>
                    <button onclick="guardarMaquina()">Guardar M√°quina</button>
                    <button onclick="cargarMaquina()">Cargar M√°quina</button>
                    <input type="file" id="cargarArchivo" accept=".json" style="display: none;">
                </div>
            </div>
        </div>
    </div>

    <script>
        function cambiarPesta√±a(i){
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');
    
            // Quitar clase 'active' de todas las pesta√±as y botones
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));
    
            // Activar la pesta√±a y bot√≥n seleccionados
            document.getElementById('tab' + i).classList.add('active');
            buttons[i].classList.add('active');
        }	
        
        const maquinaTuring = {
            estados: [],
            estadoInicial: "",
            estadosAceptacion: [],
            alfabetoEntrada: [],
            alfabetoCinta: [],
            simboloBlanco: "B",
            transiciones: {},
            cinta: [],
            cabeza: 0,
            estadoActual: "",
            ejecutando: false,
            historial: []
        };

        // Guardar configuraci√≥n b√°sica
        function guardarConfiguracion() {
            const estados = document.getElementById('estados').value.split(',').map(e => e.trim());
            const estadoInicial = document.getElementById('estadoInicial').value.trim();
            const estadosAceptacion = document.getElementById('estadosAceptacion').value.split(',').map(e => e.trim());
            const alfabetoEntrada = document.getElementById('alfabetoEntrada').value.split(',').map(e => e.trim());
            const alfabetoCinta = document.getElementById('alfabetoCinta').value.split(',').map(e => e.trim());
            const simboloBlanco = document.getElementById('simboloBlanco').value.trim();
            
            // Validaciones b√°sicas
            if (estados.length === 0 || estadoInicial === "" || estadosAceptacion.length === 0 || 
                alfabetoEntrada.length === 0 || alfabetoCinta.length === 0 || simboloBlanco === "") {
                alert("Por favor, complete todos los campos de configuraci√≥n.");
                return;
            }
            
            if (!estados.includes(estadoInicial)) {
                alert("El estado inicial debe estar en la lista de estados.");
                return;
            }
            
            for (let estado of estadosAceptacion) {
                if (!estados.includes(estado)) {
                    alert("Los estados de aceptaci√≥n deben estar en la lista de estados.");
                    return;
                }
            }
            
            for (let simbolo of alfabetoEntrada) {
                if (!alfabetoCinta.includes(simbolo)) {
                    alert("El alfabeto de entrada debe ser un subconjunto del alfabeto de cinta.");
                    return;
                }
            }
            
            if (!alfabetoCinta.includes(simboloBlanco)) {
                alert("El s√≠mbolo blanco debe estar en el alfabeto de cinta.");
                return;
            }
            
            // Guardar configuraci√≥n
            maquinaTuring.estados = estados;
            maquinaTuring.estadoInicial = estadoInicial;
            maquinaTuring.estadosAceptacion = estadosAceptacion;
            maquinaTuring.alfabetoEntrada = alfabetoEntrada;
            maquinaTuring.alfabetoCinta = alfabetoCinta;
            maquinaTuring.simboloBlanco = simboloBlanco;
            
            alert("Configuraci√≥n guardada correctamente.");
            cambiarPesta√±a(1); // Cambiar a pesta√±a de transiciones
        }

        // Agregar una transici√≥n
        function agregarTransicion() {
            const estado = document.getElementById('transEstado').value.trim();
            const leer = document.getElementById('transLeer').value.trim();
            const nuevoEstado = document.getElementById('transNuevoEstado').value.trim();
            const escribir = document.getElementById('transEscribir').value.trim();
            const direccion = document.getElementById('transDireccion').value;
            
            // Validaciones
            if (estado === "" || leer === "" || nuevoEstado === "" || escribir === "" || direccion === "") {
                alert("Por favor, complete todos los campos de la transici√≥n.");
                return;
            }
            
            if (!maquinaTuring.estados.includes(estado)) {
                alert("El estado actual no est√° en la lista de estados.");
                return;
            }
            
            if (!maquinaTuring.estados.includes(nuevoEstado)) {
                alert("El nuevo estado no est√° en la lista de estados.");
                return;
            }
            
            if (!maquinaTuring.alfabetoCinta.includes(leer)) {
                alert("El s√≠mbolo a leer no est√° en el alfabeto de cinta.");
                return;
            }
            
            if (!maquinaTuring.alfabetoCinta.includes(escribir)) {
                alert("El s√≠mbolo a escribir no est√° en el alfabeto de cinta.");
                return;
            }
            
            // Agregar transici√≥n
            if (!maquinaTuring.transiciones[estado]) {
                maquinaTuring.transiciones[estado] = {};
            }
            
            maquinaTuring.transiciones[estado][leer] = {
                nuevoEstado: nuevoEstado,
                escribir: escribir,
                direccion: direccion
            };
            
            // Actualizar tabla
            const tabla = document.getElementById('tablaTransiciones').getElementsByTagName('tbody')[0];
            const nuevaFila = tabla.insertRow();
            
            nuevaFila.insertCell(0).textContent = estado;
            nuevaFila.insertCell(1).textContent = leer;
            nuevaFila.insertCell(2).textContent = nuevoEstado;
            nuevaFila.insertCell(3).textContent = escribir;
            nuevaFila.insertCell(4).textContent = direccion;
            
            const celdaAccion = nuevaFila.insertCell(5);
            const btnEliminar = document.createElement('button');
            btnEliminar.textContent = "Eliminar";
            btnEliminar.onclick = function() {
                eliminarTransicion(estado, leer);
                tabla.removeChild(nuevaFila);
            };
            celdaAccion.appendChild(btnEliminar);
            
            // Limpiar campos
            document.getElementById('transEstado').value = "";
            document.getElementById('transLeer').value = "";
            document.getElementById('transNuevoEstado').value = "";
            document.getElementById('transEscribir').value = "";
            document.getElementById('transDireccion').value = "L";
        }

        function eliminarTransicion(estado, leer) {
            if (maquinaTuring.transiciones[estado] && maquinaTuring.transiciones[estado][leer]) {
                delete maquinaTuring.transiciones[estado][leer];
                
                // Si no hay m√°s transiciones para este estado, eliminar el estado
                if (Object.keys(maquinaTuring.transiciones[estado]).length === 0) {
                    delete maquinaTuring.transiciones[estado];
                }
            }
        }

        function iniciarSimulacion() {
            const cadenaEntrada = document.getElementById('cadenaEntrada').value;
            
            // Validar cadena de entrada
            for (let i = 0; i < cadenaEntrada.length; i++) {
                if (!maquinaTuring.alfabetoEntrada.includes(cadenaEntrada[i])) {
                    alert("La cadena contiene s√≠mbolos no v√°lidos: " + cadenaEntrada[i]);
                    return;
                }
            }
            
            // Inicializar cinta
            maquinaTuring.cinta = cadenaEntrada.split('');
            maquinaTuring.cabeza = 0;
            maquinaTuring.estadoActual = maquinaTuring.estadoInicial;
            maquinaTuring.ejecutando = true;
            maquinaTuring.historial = [];
            
            // Habilitar/deshabilitar botones
            document.getElementById('btnPaso').disabled = false;
            document.getElementById('btnDetener').disabled = false;
            
            // Actualizar interfaz
            actualizarCinta();
            document.getElementById('estadoActual').textContent = "Estado: " + maquinaTuring.estadoActual;
            document.getElementById('estadoAceptacion').textContent = "";
            document.getElementById('estadoAceptacion').className = "status";
            
            // Agregar al historial
            agregarAlHistorial("Simulaci√≥n iniciada. Estado: " + maquinaTuring.estadoActual);
        }

        function ejecutarPaso() {
            if (!maquinaTuring.ejecutando) return;
            
            const simboloActual = maquinaTuring.cinta[maquinaTuring.cabeza] || maquinaTuring.simboloBlanco;
            
            // Verificar si existe transici√≥n para el estado actual y s√≠mbolo le√≠do
            if (!maquinaTuring.transiciones[maquinaTuring.estadoActual] || 
                !maquinaTuring.transiciones[maquinaTuring.estadoActual][simboloActual]) {
                
                maquinaTuring.ejecutando = false;
                const esAceptado = maquinaTuring.estadosAceptacion.includes(maquinaTuring.estadoActual);
                
                if (esAceptado) {
                    document.getElementById('estadoAceptacion').textContent = "CADENA ACEPTADA";
                    document.getElementById('estadoAceptacion').className = "status accepted";
                    agregarAlHistorial("Cadena aceptada. Estado final: " + maquinaTuring.estadoActual);
                } else {
                    document.getElementById('estadoAceptacion').textContent = "CADENA RECHAZADA";
                    document.getElementById('estadoAceptacion').className = "status rejected";
                    agregarAlHistorial("Cadena rechazada. No hay transici√≥n definida para (" + 
                                      maquinaTuring.estadoActual + ", " + simboloActual + ")");
                }
                
                document.getElementById('btnPaso').disabled = true;
                return;
            }
            
            // Obtener la transici√≥n
            const transicion = maquinaTuring.transiciones[maquinaTuring.estadoActual][simboloActual];
            
            // Ejecutar la transici√≥n
            // 1. Escribir en la cinta
            maquinaTuring.cinta[maquinaTuring.cabeza] = transicion.escribir;
            
            // 2. Mover la cabeza
            if (transicion.direccion === 'L') {
                if (maquinaTuring.cabeza === 0) {
                    // Insertar s√≠mbolo en blanco al inicio de la cinta
                    maquinaTuring.cinta.unshift(maquinaTuring.simboloBlanco);
                    // La cabeza se mantiene en 0 porque la cinta se desplaz√≥
                } else {
                    maquinaTuring.cabeza--;
                }
            } else if (transicion.direccion === 'R') {
                 maquinaTuring.cabeza++;
                // Si la cabeza supera el final de la cinta, agregar un s√≠mbolo en blanco
                if (maquinaTuring.cabeza >= maquinaTuring.cinta.length) {
                maquinaTuring.cinta.push(maquinaTuring.simboloBlanco);
                 }
            }
            // Para 'S' (permanecer), no se mueve la cabeza
            
            // 3. Cambiar estado
            const estadoAnterior = maquinaTuring.estadoActual;
            maquinaTuring.estadoActual = transicion.nuevoEstado;
            
            // Actualizar interfaz
            actualizarCinta();
            document.getElementById('estadoActual').textContent = "Estado: " + maquinaTuring.estadoActual;
            
            // Agregar al historial
            agregarAlHistorial("Transici√≥n: (" + estadoAnterior + ", " + simboloActual + ") ‚Üí (" + 
                             transicion.nuevoEstado + ", " + transicion.escribir + ", " + transicion.direccion + ")");
            
            // Verificar si es estado de aceptaci√≥n
            if (maquinaTuring.estadosAceptacion.includes(maquinaTuring.estadoActual)) {
                document.getElementById('estadoAceptacion').textContent = "CADENA ACEPTADA";
                document.getElementById('estadoAceptacion').className = "status accepted";
                maquinaTuring.ejecutando = false;
                document.getElementById('btnPaso').disabled = true;
                agregarAlHistorial("Cadena aceptada. Estado final: " + maquinaTuring.estadoActual);
            }
        }

        // Actualizar visualizaci√≥n de la cinta
        function actualizarCinta() {
            const cintaContainer = document.getElementById('cinta');
            cintaContainer.innerHTML = '';
            
            // Determinar rango de celdas a mostrar
            const inicio = Math.max(0, maquinaTuring.cabeza - 5);
            const fin = Math.max(maquinaTuring.cabeza + 6, maquinaTuring.cinta.length);
            
            for (let i = inicio; i < fin; i++) {
                const celda = document.createElement('div');
                celda.className = 'tape-cell';
                
                if (i === maquinaTuring.cabeza) {
                    celda.classList.add('active');
                }
                
                if (i < maquinaTuring.cinta.length) {
                    celda.textContent = maquinaTuring.cinta[i];
                } else {
                    celda.textContent = maquinaTuring.simboloBlanco;
                }
                
                cintaContainer.appendChild(celda);
            }
        }

        // Agregar entrada al historial
        function agregarAlHistorial(mensaje) {
            maquinaTuring.historial.push(mensaje);
            const historialContainer = document.getElementById('historial');
            
            const item = document.createElement('div');
            item.className = 'history-item';
            item.textContent = mensaje;
            
            historialContainer.appendChild(item);
            historialContainer.scrollTop = historialContainer.scrollHeight;
        }

        // Detener simulaci√≥n
        function detenerSimulacion() {
            maquinaTuring.ejecutando = false;
            document.getElementById('btnPaso').disabled = true;
            document.getElementById('btnDetener').disabled = true;
            agregarAlHistorial("Simulaci√≥n detenida por el usuario.");
        }

        // Reiniciar simulaci√≥n
        function reiniciarSimulacion() {
            iniciarSimulacion();
        }

        // Guardar M√°quina
        async function guardarMaquina() {
            if (!maquinaTuring || maquinaTuring.estados.length === 0) {
                alert("No hay ninguna m√°quina configurada para guardar.");
                return;
            }

            // Creamos el contenido JSON
            const data = {
                alfabetoEntrada: maquinaTuring.alfabetoEntrada || [],
                alfabetoCinta: maquinaTuring.alfabetoCinta || [],
                estados: maquinaTuring.estados || [],
                estadoInicial: maquinaTuring.estadoInicial || "",
                estadosAceptacion: maquinaTuring.estadosAceptacion || [],
                transiciones: maquinaTuring.transiciones || {},
                simboloBlanco: maquinaTuring.simboloBlanco || "B"
            };

            const json = JSON.stringify(data, null, 4);

            try {
                // Abrir el cuadro de di√°logo "Guardar como..."
                const handle = await window.showSaveFilePicker({
                    suggestedName: "maquina_turing.json",
                    types: [{
                        description: "Archivo JSON",
                        accept: { "application/json": [".json"] }
                    }]
                });

                const writable = await handle.createWritable();
                await writable.write(json);
                await writable.close();

                alert("M√°quina guardada correctamente.");
                agregarAlHistorial("M√°quina guardada correctamente en ubicaci√≥n seleccionada.");
            } catch (error) {
                console.error("Error al guardar el archivo:", error);
                alert("No se pudo guardar la m√°quina (quiz√°s cancelaste la acci√≥n).");
            }
        }

        //Cargar M√°quina
        function cargarMaquina() {
            const input = document.createElement("input");
            input.type = "file";
            input.accept = ".json";

            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);

                        // Validar estructura m√≠nima del archivo
                        if (!data.estados || !data.estadoInicial || !(data.estadoAceptacion || data.estadosAceptacion)) {
                            alert("El archivo no contiene una m√°quina de Turing v√°lida.");
                            return;
                        }

                        // Cargar datos con compatibilidad entre formatos
                        maquinaTuring.estados = data.estados;
                        maquinaTuring.estadoInicial = data.estadoInicial;
                        maquinaTuring.estadosAceptacion = data.estadosAceptacion || data.estadoAceptacion || [];
                        maquinaTuring.alfabetoEntrada = data.alfabetoEntrada || data.alfabeto || [];
                        maquinaTuring.alfabetoCinta = data.alfabetoCinta || data.alfabeto || [];
                        maquinaTuring.simboloBlanco = data.simboloBlanco || "_";
                        maquinaTuring.transiciones = data.transiciones || {};
                        maquinaTuring.cinta = [];
                        maquinaTuring.cabeza = 0;
                        maquinaTuring.estadoActual = maquinaTuring.estadoInicial;
                        maquinaTuring.ejecutando = false;
                        maquinaTuring.historial = [];

                        // Mostrar datos cargados en los campos
                        document.getElementById("estados").value = maquinaTuring.estados.join(", ");
                        document.getElementById("estadoInicial").value = maquinaTuring.estadoInicial;
                        document.getElementById("estadosAceptacion").value = maquinaTuring.estadosAceptacion.join(", ");
                        document.getElementById("alfabetoEntrada").value = maquinaTuring.alfabetoEntrada.join(", ");
                        document.getElementById("alfabetoCinta").value = maquinaTuring.alfabetoCinta.join(", ");
                        document.getElementById("simboloBlanco").value = maquinaTuring.simboloBlanco;

                        // Limpiar y reconstruir la tabla de transiciones
                        const tbody = document.getElementById("tablaTransiciones").querySelector("tbody");
                        tbody.innerHTML = "";
                        for (let estado in maquinaTuring.transiciones) {
                            for (let leer in maquinaTuring.transiciones[estado]) {
                                const t = maquinaTuring.transiciones[estado][leer];
                                const row = tbody.insertRow();
                                row.insertCell(0).textContent = estado;
                                row.insertCell(1).textContent = leer;
                                row.insertCell(2).textContent = t.nuevoEstado;
                                row.insertCell(3).textContent = t.escribir;
                                row.insertCell(4).textContent = t.direccion;
                                const cellAccion = row.insertCell(5);
                                const btnEliminar = document.createElement("button");
                                btnEliminar.textContent = "Eliminar";
                                btnEliminar.onclick = () => {
                                    eliminarTransicion(estado, leer);
                                    tbody.removeChild(row);
                                };
                                cellAccion.appendChild(btnEliminar);
                            }
                        }

                        // Actualizar interfaz visual
                        actualizarCinta();
                        document.getElementById("estadoActual").textContent = "Estado: " + maquinaTuring.estadoActual;
                        document.getElementById("estadoAceptacion").textContent = "";
                        document.getElementById("estadoAceptacion").className = "status";
                        document.getElementById("btnPaso").disabled = true;
                        document.getElementById("btnDetener").disabled = true;

                        // Confirmaci√≥n y registro
                        agregarAlHistorial(`M√°quina cargada correctamente desde '${file.name}'.`);
                        alert("M√°quina cargada correctamente.");
                    } catch (error) {
                        console.error("Error al leer el archivo:", error);
                        alert("Error al cargar la m√°quina. Verifica el archivo JSON.");
                    }
                };

                reader.readAsText(file);
            };

            input.click();
        }

        //Funciones para limpiar campos en cada secci√≥n 
        //Limpiar configuraci√≥n
        function limpiarConfiguracion() {
            const ids = ["estados", "estadoInicial", "estadosAceptacion", "alfabetoEntrada", "alfabetoCinta", "simboloBlanco"];

            ids.forEach(id => {
                const input = document.getElementById(id);
                if (input) input.value = "";
            });

            agregarAlHistorial("Campos de configuraci√≥n limpiados.");
            alert("Campos de configuraci√≥n limpiados");
        }

        //Limpiar Transiciones
        function limpiarTransiciones() {
            const ids = ["transEstado", "transLeer", "transNuevoEstado", "transEscribir", "transDireccion"];
            
            ids.forEach(id => {
                const input = document.getElementById(id);
                if (input && input.tagName.toLowerCase() === "select") {
                    input.selectedIndex = 0;
                } else if (input) {
                    input.value = "";
                }
            });

            agregarAlHistorial("Campos de transiciones limpiados.");
            alert("Campos de transiciones limpiados");
        }

        //Limpiar Simulaci√≥n
        function limpiarSimulacion() {
            const inputCadena = document.getElementById("cadenaEntrada");
            if (inputCadena) inputCadena.value = "";

            // Limpiar cinta visual y datos de simulaci√≥n
            if (maquinaTuring) {
                maquinaTuring.cinta = [];
                maquinaTuring.cabeza = 0;
                maquinaTuring.estadoActual = "";
                maquinaTuring.ejecutando = false;
                actualizarCinta();
            }

            // Restablecer texto de estado
            const estadoActual = document.getElementById("estadoActual");
            const estadoAceptacion = document.getElementById("estadoAceptacion");
            if (estadoActual) estadoActual.textContent = "No iniciado";
            if (estadoAceptacion) {
                estadoAceptacion.textContent = "";
                estadoAceptacion.className = "status";
            }

            // Desactivar botones de control
            document.getElementById("btnPaso").disabled = true;
            document.getElementById("btnDetener").disabled = true;

            agregarAlHistorial("Campos de simulaci√≥n limpiados.");
            alert("Campos de simulaci√≥n limpiados");
        }
    </script>
</body>
</html>
